<div th:fragment="tabelaChamados"> 
    <div id="toolbar">
        <div class="btn-group btn-group-sm" role="group" aria-label="Painel Atendimento">
            <input type="radio" class="btn-check" name="btnradio" id="button1" autocomplete="off" checked=""/>
            <label class="btn btn-outline-success" for="button1">Pendentes
                <span id="spanPendente" class="badge cor-g text-wrap text-dark">0</span>
            </label>
            <input type="radio" class="btn-check" name="btnradio" id="button2" autocomplete="off"/>
            <label class="btn btn-outline-success bg-gradient" for="button2">Em Análise
                <span id="spanEmAnalise"class="badge cor-g text-wrap text-dark">0</span> 
            </label>
            <input type="radio" class="btn-check" name="btnradio" id="button3" autocomplete="off"/>
            <label class="btn btn-outline-success bg-gradient" for="button3">Finalizados
                <span id="spanFinalizados"class="badge cor-g text-wrap text-dark">0</span> 
            </label>
        </div>
        <div id="tabelaSelecionada" hidden="true" value="pendentes"></div>
    </div>
    <table
        id="table"
        data-toolbar="#toolbar"
        data-toggle="table"
        data-search="true"     
        data-search-accent-neutralise="true"
        data-search-highlight="true"
        data-pagination="true"
        data-buttons-prefix="btn-md btn"
        data-buttons-class="success bg-gradient"
        data-buttons="novoChamadoTabela"
        data-show-button-text="false"
        data-show-pagination-switch="false" 
        data-show-refresh="true"
        data-show-toggle="false"
        data-show-fullscreen="true"
        data-show-columns="true"
        data-show-columns-toggle-all="true"
        data-show-export="true"
        data-page-list="[7, 30, 60, 120, All]"
        data-remember-order="true"
        class="table-striped table-sm"
        data-sort-name="dataAbertura"
        data-sort-order="desc"
        data-sort-reset-page="true"
        data-sortable="true"
        data-detail-view="true"
        data-detail-view-by-click="true"
        data-detail-view-icon="false"
        data-detail-formatter="detailFormatter"
        data-url="/atendimento/chamados/aguardando">
        <thead>
            <tr><!--class="badge bg-light text-dark" atendimentos/tipoTabela?tipo=aguardando-->
                <th data-field="ichamado" data-sortable="true" data-formatter="acoesTabelaChamado" data-detail-formatter="idFormatter">Nº</th>
                <th data-field="caspEntidadesList" data-sortable="true" data-halign="left" data-align="left" data-formatter="entidades" class="col-md-3">Entidade</th>
                <th data-field="caspAreasList" data-sortable="true" data-halign="left" data-align="center" data-formatter="areas">Área</th>
                <th data-field="dataAbertura" data-sortable="true" data-formatter="spanTabela">Abertura</th>
                <th data-field="iusuarioAbertura.nome" data-sortable="true" data-formatter="spanTabela">Usuário</th>
                <th data-field="resumoChamado" data-sortable="true" data-formatter="textoNormalTabela" class="col-md-4 small">Resumo</th>
                <th data-field="isituacao" data-sortable="true" data-align="center" data-formatter="situacaoChamado" data-detail-formatter="situacaoFormatter">Situação</th>
            </tr>
        </thead>
    </table> 
    <script>

        function detailFormatter(index, row) {
            let html = [];
            $.each(row, function (key, value) {
                switch (key) {
                    case "descricaoChamado":
                        let descricao = [
                            `<label for="descricao" class="form-label">Descrição</label>`,
                            `<div class="card-header">
                                    <textarea
                                        id="descricao" 
                                        class="form-control casp-textarea fonte"
                                        aria-label="Descrição"
                                        readonly="">${value}</textarea>
                                 </div>`
                        ].join('');
                        html.push(descricao);
                        break;
                    case "iusuarioEncaminhamento":
                        if (value) {
                            html.push("<p>" + key + ": " + value.nome + "</p>");
                        }
                        break;
                    default:
                        html.push("<p>" + key + ": " + value + "</p>");
                        break;
                }
            });
            return html.join('');
        }

        function idFormatter(index, row) {
            return "";
        }

        function situacaoFormatter(index, row) {
            return index + '. Item ID: ' + row.resumoChamado;
        }

        function novoChamadoTabela() {
            return {
                btnAdd: {
                    text: 'Novo',
                    icon: 'bi bi-plus-lg',
                    event: function () {
                        chamadoUsuarioLogado();
                    }
                }
            };
        }


        $(function () {
            $('#button1').click(function () {
                atualizarTotais();
                //document.getElementById("tabelaSelecionada").setAttribute('value', 'aguardando');
                $('#table').bootstrapTable('refreshOptions', {
                    showColumns: true,
                    search: true,
                    showRefresh: true,
                    url: '/atendimento/chamados/aguardando'
                });
            });
        });

        $(function () {
            $('#button2').click(function () {
                atualizarTotais();
                //document.getElementById("tabelaSelecionada").setAttribute('value', 'atendendo');
                $('#table').bootstrapTable('refreshOptions', {
                    showColumns: true,
                    search: true,
                    showRefresh: true,
                    url: '/atendimento/chamados/em-analise'
                });
            });
        });

        $(function () {
            $('#button3').click(function () {
                atualizarTotais();
                //document.getElementById("tabelaSelecionada").setAttribute('value', 'encerrados');
                $('#table').bootstrapTable('refreshOptions', {
                    showColumns: true,
                    search: true,
                    showRefresh: true,
                    url: '/atendimento/chamados/finalizados'
                });
            });
        });

        $(function () {
            let tabelaSelecionada = document.getElementById('tabelaSelecionada').value;
            switch (tabelaSelecionada) {
                case 'pendentes':
                    document.getElementById('button1').click();
                    break;
                case 'emAtendimento':
                    document.getElementById('button2').click();
                    break;
                case 'finalizados':
                    document.getElementById('button3').click();
                    break;
                default:
                    document.getElementById('button1').click();
                    break;
            }
        });
    </script>
    <script src="/public/js/bootstrap-table-pt-BR.min.js"></script>
</div>
